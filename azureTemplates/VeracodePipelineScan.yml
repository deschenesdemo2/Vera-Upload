#VeracodePipelineScan.yml file

parameters:
- name: 'VID'
  type: string
  default: ''
- name: 'VKEY'
  type: string
  default: ''

steps:
  - task: DownloadPipelineArtifact@2
    displayName: 'Download Artifact to be Scanned'
    inputs:
      artifact: verademo_package

  - task: VeracodePipelineScan@0
    displayName: 'SAST - Pipeline Scan'
    condition: and(succeeded(), eq(variables['build.sourceBranch'], 'refs/heads/featureX'))
    inputs:
      VeracodeAPIID: ${{ parameters.VID }}
      VeracodeAPIsecret: ${{ parameters.VKEY }}
      fileToScan: '$(Pipeline.Workspace)/verademo.war'
      breakPipeline: true
      baselineFileOptions: 'standard'

